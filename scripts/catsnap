#!/usr/bin/env python

import sys
import catsnap
from catsnap import Config
from catsnap.image import Image
from catsnap.tag import Tag

USAGE = """
usage statement TBD
"""

def main():
    if len(sys.argv) < 2:
        show_help()
    command = sys.argv[1]
    if command == 'add':
        if len(sys.argv) < 4:
            show_help()
        add(sys.argv[2], sys.argv[3:])
    elif command == 'find':
        if len(sys.argv) < 3:
            show_help()
        find(sys.argv[2:])
    else:
        show_help()

def add(url, tags):
    config = catsnap.Config()
    config.ensure_config_files_exist()
    bucket = config.bucket()
    table = config.table()
    image = Image.new_from_url(url, tags=tags)
    image.save(bucket, table)
    print image.url(bucket)

def find(tags):
    config = catsnap.Config()
    config.ensure_config_files_exist()
    bucket = config.bucket()
    table = config.table()
    for tag_name in tags:
        tag = Tag(tag_name)
        for filename in tag.get_images(table):
            print Image.url_for_filename(filename, bucket)

def show_help():
    sys.stderr.write(USAGE)
    sys.exit(1)

main()

